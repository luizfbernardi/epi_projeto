{% extends 'global/index.html'%}

{% block title %} Inserir Empréstimo {% endblock title %}

{% block content %} 
<body>
    <h1>Inserir Empréstimo</h1>

    {% if messages %}
        <ul>
            {% for message in messages %}
                <li>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}

    <form action="{% url 'inserir_emprestimo' %}" method="POST">
        {% csrf_token %}

        <label for="numero_emprestimo">Número de Identificação Empréstimo:</label>
        <input type="number" id="numero_emprestimo" name="numero_emprestimo" required><br><br>

        <label for="numero_colaborador">Número de Identificação Colaborador:</label>
        <select name="numero_colaborador" id="numero_colaborador" onchange="mostrarNomeColaborador()" required>
            <option value="">Selecione</option>
            {% for colaborador in colaboradores %}
                <option value="{{ colaborador.id }}" data-nome="{{ colaborador.nome }}">
                    {{ colaborador.numero_colaborador }}
                </option>
            {% endfor %}
        </select>
        <p id="nome_colaborador"></p>

        <label for="numero_epi">Número de Identificação Epi:</label>
        <select name="numero_epi" id="numero_epi" onchange="mostrarTipoEpi()" required>
            <option value="">Selecione</option>
            {% for epi in epis %}
                <option value="{{ epi.id }}" data-tipo="{{ epi.tipo }}">
                    {{ epi.numero_epi }}
                </option>
            {% endfor %}
        </select>
        <p id="tipo_epi"></p>

        <label>Data do Empréstimo (automática):</label>
        <input type="text" value="{{ today|date:'Y-m-d' }}" readonly><br><br>

        <label for="data_prevista">Data Prevista para Devolução:</label>
        <input type="date" id="data_prevista" name="data_prevista" required><br><br>

        <label for="observacao">Observação:</label>
        <input type="text" id="observacao" name="observacao" required><br><br>

        <button type="submit">Salvar</button>

        <a href="{% url 'emprestimos' %}">Voltar para página de empréstimos</a>
    </form>

    <script>
        function mostrarNomeColaborador() {
            const select = document.getElementById('numero_colaborador');
            const nome = select.options[select.selectedIndex].getAttribute('data-nome');
            document.getElementById('nome_colaborador').textContent = nome ? "Nome: " + nome : "";
        }

        function mostrarTipoEpi() {
            const select = document.getElementById('numero_epi');
            const tipo = select.options[select.selectedIndex].getAttribute('data-tipo');
            document.getElementById('tipo_epi').textContent = tipo ? "Tipo: " + tipo : "";
        }
    </script>
</body>
{% endblock content %}